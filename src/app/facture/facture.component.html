<div class="container-fluide">
  <div class="row justify-content-evenly">
    <div class="col-sm-12 card">
      <div class="card-body table-responsive">
        <div class="header">
          <h2>Liste des factures</h2>

          <div
            class="btn-group"
            ngbDropdown
            role="group"
            aria-label="Button group with nested dropdown"
          >
            <button
              class="exporter btn btn-outline-secondary"
              ngbDropdownToggle
            >
              Exporter
              <i class="bi bi-box-arrow-up"></i>
            </button>
            <div class="dropdown-menu" ngbDropdownMenu>
              <button ngbDropdownItem (click)="downloadFile(listFacture)">
                En CSV
              </button>
              <button ngbDropdownItem (click)="exportAsXLSX()">En Excel</button>
            </div>
          </div>
        </div>
        <hr />
        <table class="table">
          <thead class="text-center">
            <tr>
              <th>Montant (dt)</th>
              <th>Remise (dt)</th>
              <th>Date de création</th>
              <th>Status</th>
              <th>Details</th>
              <th></th>
            </tr>
          </thead>
          <tbody class="text-center">
            <tr
              *ngFor="
                let f of listFacture
                  | paginate: { itemsPerPage: 3, currentPage: p };
                let i = index
              "
            >
              <th>{{ f.montantFacture }}</th>
              <th>{{ f.montantRemise }}</th>
              <th>{{ f.dateFacture | date: "dd-MM-yyyy" }}</th>
              <th>
                <span
                  *ngIf="f.active == true"
                  class="badge rounded-pill bg-light text-dark"
                >
                  active
                </span>
              </th>
              <th>
                <a (click)="factureDetail = f; openDetails(contentDetail)">
                  <i class="bi bi-info-square-fill"></i>
                </a>
              </th>
              <th>
                <button
                  class="btn btn-outline-danger mx-2"
                  (click)="open(contentConfirme); FactureaSupprimer(f, i)"
                >
                  <i class="bi bi-trash"> </i>
                </button>

                <button
                  class="btn btn-outline-warning"
                  (click)="open(contentEdit)"
                >
                  <i class="bi bi-pencil-square"></i>
                </button>
              </th>
            </tr>
          </tbody>
          <pagination-controls (pageChange)="p = $event"></pagination-controls>
        </table>
      </div>
    </div>

    <ng-template #content let-modal>
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
          Ajouter une Facture
          <i class="bi bi-file-earmark-text"></i>
        </h4>
        <button
          type="button"
          class="close btn btn-outline-danger"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div ngForm #f1="ngForm">
            <div class="form-floating mb-3">
              <input
                type="number"
                name="montant"
                ngModel
                [(ngModel)]="facture.montantFacture"
                #montant="ngModel"
                required
                class="form-control"
              />
              <label for="floatingInput">Montant Facture</label>
              <div *ngIf="montant.touched && montant.errors">
                <div
                  class="alert alert-danger"
                  role="alert"
                  *ngIf="montant.errors.required"
                >
                  Champ Obligatoire
                </div>
              </div>
            </div>
            <div class="form-floating mb-3">
              <input
                type="number"
                name="remise"
                ngModel
                [(ngModel)]="facture.montantRemise"
                #remise="ngModel"
                required
                class="form-control"
              />
              <label for="floatingPassword">Remise</label>
              <div *ngIf="remise.touched && remise.errors">
                <div
                  class="alert alert-danger"
                  role="alert"
                  *ngIf="remise.errors.required"
                >
                  Champ Obligatoire
                </div>
              </div>
            </div>
          </div>
          <!-- <div *ngIf="f1.valid" ngForm #f2="ngForm">
            <div class="form-floating mb-3">
              <input
                type="number"
                name="pourcentageRemise"
                ngModel
                [(ngModel)]="facture.detailFacture[0].pourcentageRemise"
                #pourcentageRemise="ngModel"
                required
                class="form-control"
              />
              <label for="floatingPassword">Pourcentage Remise</label>
              <div
                *ngIf="pourcentageRemise.touched && pourcentageRemise.errors"
              >
                <div
                  class="alert alert-danger"
                  role="alert"
                  *ngIf="pourcentageRemise.errors.required"
                >
                  Champ Obligatoire
                </div>
              </div>
            </div>
            <div class="form-floating mb-3">
              <input
                type="number"
                name="prixTotal"
                ngModel
                [(ngModel)]="facture.detailFacture[0].prixTotal"
                #prixTotal="ngModel"
                required
                class="form-control"
              />
              <label for="floatingInput">Prix Totale</label>
              <div *ngIf="prixTotal.touched && prixTotal.errors">
                <div
                  class="alert alert-danger"
                  role="alert"
                  *ngIf="prixTotal.errors.required"
                >
                  Champ Obligatoire
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="submit"
                class="btn btn-outline-dark"
                (click)="modal.close('Save click'); ajouter()"
                [disabled]="f1.invalid || f2.invalid"
              >
                Suivant
              </button>
            </div>
          </div> -->
          <div class="modal-footer">
            <button
              type="submit"
              class="btn btn-outline-dark"
              (click)="modal.close('Save click'); ajouter()"
              [disabled]="f1.invalid"
            >
              Suivant
            </button>
          </div>
        </form>
      </div>
    </ng-template>
    <ng-template #contentDetail let-modal>
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
          Détails d'une Facture
          <i class="bi bi-file-earmark-text"></i>
        </h4>
        <button
          type="button"
          class="close btn btn-outline-danger"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <h5 class="col-6">Pourcentage Remise :</h5>
          <label class="col-4"
            >{{ factureDetail.detailFacture[0].pourcentageRemise }} %
          </label>
        </div>
        <div class="row">
          <h5 class="col-6">Montant Remise :</h5>
          <label class="col-4"
            >{{ factureDetail.detailFacture[0].montantRemise }} dt</label
          >
        </div>
        <div class="row">
          <h5 class="col-6">Quantité :</h5>
          <label class="col-4">{{ factureDetail.detailFacture[0].qte }}</label>
        </div>
        <div class="row">
          <h5 class="col-6">Prix totale :</h5>
          <label class="col-4"
            >{{ factureDetail.detailFacture[0].prixTotal }} dt</label
          >
        </div>
      </div>
    </ng-template>

    <ng-template #contentEdit let-modal>
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
          Modifier une Facture
          <i class="bi bi-file-earmark-text"></i>
        </h4>
        <button
          type="button"
          class="close btn btn-outline-danger"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form ngForm #f="ngForm">
          <div class="form-floating mb-3">
            <input
              type="number"
              name="montant"
              ngModel
              #montant="ngModel"
              required
              class="form-control"
            />
            <label for="floatingInput">Montant Facture</label>
            <div *ngIf="montant.touched && montant.errors">
              <div
                class="alert alert-danger"
                role="alert"
                *ngIf="montant.errors.required"
              >
                Champ Obligatoire
              </div>
            </div>
          </div>
          <div class="form-floating mb-3">
            <input
              type="number"
              name="remise"
              ngModel
              #remise="ngModel"
              required
              class="form-control"
              id="floatingPassword"
            />
            <label for="floatingPassword">Remise</label>
            <div *ngIf="remise.touched && remise.errors">
              <div
                class="alert alert-danger"
                role="alert"
                *ngIf="remise.errors.required"
              >
                Champ Obligatoire
              </div>
            </div>
          </div>
          <div class="form-floating mb-3">
            <input
              type="date"
              ngModel
              #date="ngModel"
              required
              class="form-control"
              id="floatingInput"
            />
            <label for="floatingInput">Date </label>
            <div *ngIf="date.touched && date.errors">
              <div
                class="alert alert-danger"
                role="alert"
                *ngIf="date.errors.required"
              >
                Champ Obligatoire
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="submit"
              class="btn btn-outline-dark"
              (click)="modal.close('Save click')"
              [disabled]="f.invalid"
            >
              Save
            </button>
          </div>
        </form>
      </div>
    </ng-template>

    <ng-template #contentConfirme let-modal>
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title1">
          Supprimer le facture
        </h4>
        <button
          type="button"
          class="btn btn-outline-danger"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Vous voulez vraiment supprimer cette facture ?</p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="modal.close('close')"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-outline-danger"
          (click)="
            modal.close('Save click'); SupprimerFacture(factureSupprimer)
          "
        >
          Delete
        </button>
      </div>
    </ng-template>

    <div class="row justify-content-evenly">
      <div class="col-sm-5 card">
        <div class="card-body">
          <div class="header">
            <h3 class="card-title text-center">Ajouter une Facture</h3>
            <i
              class="bi bi-file-earmark-plus-fill"
              style="font-size: 1.5em"
            ></i>
          </div>

          <hr />
          <p class="card-text">
            Vous pouvez ajouter une facture en cliquant sur le bouton en bas .
          </p>
          <button
            class="btn btn-success"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            (click)="open(content)"
          >
            <i class="bi bi-plus"></i>
            Ajouter une facture
          </button>
        </div>
      </div>
      <div class="col-sm-5 card">
        <div class="card-body">
          <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
            <ngb-panel title="Simple">
              <ng-template ngbPanelContent>
                Anim pariatur cliche reprehenderit, enim eiusmod high life
                accusamus terry richardson ad squid. 3 wolf moon officia aute,
                non cupidatat skateboard dolor brunch. Food truck quinoa
                nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua
                put a bird on it squid single-origin coffee nulla assumenda
                shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore
                wes anderson cred nesciunt sapiente ea proident. Ad vegan
                excepteur butcher vice lomo. Leggings occaecat craft beer
                farm-to-table, raw denim aesthetic synth nesciunt you probably
                haven't heard of them accusamus labore sustainable VHS.
              </ng-template>
            </ngb-panel>
            <ngb-panel>
              <ng-template ngbPanelTitle>
                <span>&#9733; <b>Fancy</b> title &#9733;</span>
              </ng-template>
              <ng-template ngbPanelContent>
                Anim pariatur cliche reprehenderit, enim eiusmod high life
                accusamus terry richardson ad squid. 3 wolf moon officia aute,
                non cupidatat skateboard dolor brunch. Food truck quinoa
                nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua
                put a bird on it squid single-origin coffee nulla assumenda
                shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore
                wes anderson cred nesciunt sapiente ea proident. Ad vegan
                excepteur butcher vice lomo. Leggings occaecat craft beer
                farm-to-table, raw denim aesthetic synth nesciunt you probably
                haven't heard of them accusamus labore sustainable VHS.
              </ng-template>
            </ngb-panel>
          </ngb-accordion>
        </div>
      </div>
    </div>
  </div>
</div>
